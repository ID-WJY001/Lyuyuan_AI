# 苏糖对话问题修复指南

## 问题描述

苏糖在网页版中只会重复关于烘焙社招新的内容，无法正确理解用户的输入，对话没有连贯性和上下文理解能力。

## 原因分析

主要原因是API连接问题。系统无法连接到DeepSeek的AI服务，因此退回到使用预设的简单回复，这些回复没有上下文理解能力，导致对话看起来不连贯且重复。

## 修复步骤

1. **设置API密钥**

   首先，您需要获取一个有效的DeepSeek API密钥。可以从DeepSeek官方网站获取：https://platform.deepseek.com/

2. **配置环境变量**

   有三种方式设置API密钥：

   - **方法1：创建.env文件（推荐）**
     在项目根目录创建一个名为`.env`的文件（您可以复制`.env.example`文件），并添加以下内容：
     ```
     DEEPSEEK_API_KEY=your_actual_api_key_here
     ```
     
   - **方法2：直接在代码中设置**
     打开`web_start.py`文件，找到`setup_api_key`函数，将备用API密钥替换为您的实际密钥：
     ```python
     api_key = "your-actual-deepseek-api-key"  # 替换这里
     ```
     
   - **方法3：设置系统环境变量**
     在系统环境变量中添加`DEEPSEEK_API_KEY`变量。

3. **重启Web应用**

   设置好API密钥后，重新启动web应用：
   ```
   start_web.bat
   ```
   或直接运行：
   ```
   python web_start.py
   ```

4. **验证修复**

   在浏览器中访问`http://localhost:5000`并与苏糖对话。如果一切正常，她现在应该能够理解您的输入并提供连贯的回复。

## 故障排除

如果设置API密钥后仍然遇到问题：

1. **检查控制台输出**
   查看命令行窗口中是否有错误信息，特别是"API连接错误"相关的消息。

2. **验证API密钥**
   确保您使用的是有效的DeepSeek API密钥，并且密钥有足够的配额。

3. **检查网络连接**
   确保您的计算机可以连接到互联网，并且可以访问DeepSeek的API服务器。

4. **使用备用API服务**
   如果您无法使用DeepSeek API，可以修改代码使用其他AI服务提供商，如OpenAI、Claude等。需要修改`Su_Tang.py`和`web_app/app.py`中的API调用部分。

## 进一步改进

为了使系统更加健壮，您可以：

1. 实现更复杂的缓存机制，减少API调用频率
2. 添加更多备用的预设回复，使离线模式下的对话更加多样化
3. 实现本地运行的小型语言模型，作为在线API的备用

希望这些步骤能帮助您解决苏糖的对话问题！ 