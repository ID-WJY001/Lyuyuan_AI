# ç»¿å›­ä¸­å­¦ç‰©è¯­ (Green Garden High School Story)

> v1.0.1 â€” å¤šè§’è‰²é¦–å‘ç‰ˆï¼šäº”åå¯é€‰è§’è‰²ã€ç»Ÿä¸€åˆ†ææ¨¡æ¿ã€äººè®¾å»æ ‡ç­¾åŒ–ã€‚

**ç»¿å›­ä¸­å­¦ç‰©è¯­**æ˜¯ä¸€æ¬¾ç”± LLM é©±åŠ¨çš„è½»å™äº‹ RPGã€‚ä½ å°†æ‰®æ¼”ä¸»è§’ï¼Œåœ¨å­¦æ ¡ç™¾å›¢å¤§æˆ˜æ—¶ä¸å¤šä¸ªæœ‰â€œæ¸©åº¦â€çš„ AI è§’è‰²åœ¨ç»¿å›­ä¸­å­¦æ¸¸é€›ã€æ­è¯ä¸é è¿‘ã€‚

---

## ğŸ†• ç©æ³•äº®ç‚¹

- âœ¨ å¤šè§’è‰²å¯é€‰ï¼ˆ5 äººï¼‰ï¼šè‹ç³–ã€æ—é›¨å«ã€ç½—ä¸€è«ã€é¡¾ç›¼ã€å¤æ˜Ÿæ™šï¼ˆæ¬¢è¿é¡µä¸‹æ‹‰é€‰æ‹©ï¼‰
- ğŸ§  ä¸€æ¬¡è¯·æ±‚ï¼ŒåŒé€šé“äº§å‡ºï¼šè§’è‰²å›å¤ + å†…å¿ƒåˆ†æï¼ˆJSONï¼‰ï¼Œä¿è¯â€œè¯´/æƒ³/æ”¹çŠ¶æ€â€ä¸€è‡´
- ğŸ’– æƒ…ç»ªä¸å…³ç³»ï¼šæ ¹æ®åˆ†æè°ƒæ•´å¥½æ„Ÿåº¦ã€æ— èŠåº¦ã€å…³ç³»é˜¶æ®µï¼Œå¹¶è§¦å‘äº‹ä»¶
- ğŸ—‚ï¸ Prompt é©±åŠ¨äººæ ¼ï¼šè§’è‰² Persona + Analysis æ¨¡æ¿å¯å¿«é€Ÿè¿­ä»£ï¼Œæ”¯æŒâ€œé£æ ¼ä¸äººæƒ…å‘³â€çº¦æŸ
- ğŸ’¾ è½»é‡å­˜æ¡£ï¼šJSON æ–‡ä»¶å­˜æ¡£ï¼Œå‰ç«¯ä¸€é”®ä¿å­˜/è¯»å–ï¼Œæ§½ä½ 1-5

---

## ğŸ§© å¯é€‰è§’è‰²ï¼ˆåˆå§‹å¥½æ„Ÿåº¦ï¼‰

- è‹ç³–ï¼ˆ30ï¼‰ï¼šçƒ˜ç„™ç¤¾æ‘Šä½é™„è¿‘çš„æ¸©æŸ”å¥³å­©ï¼›ç”œç‚¹ä¸éŸ³ä¹æ˜¯å¥¹çš„å®‰å…¨æ„Ÿ
- æ—é›¨å«ï¼ˆ50ï¼‰ï¼šèˆè¹ˆç¤¾é™„è¿‘çš„æ°”æ°›æ‹…å½“ï¼›å…ƒæ°”ç›´ç»™ï¼Œä¹Ÿä¼šè®¤çœŸå®‰æ…°
- ç½—ä¸€è«ï¼ˆ35ï¼‰ï¼šç§‘æŠ€åä¼šé™„è¿‘çš„æ…¢çƒ­åŒå­¦ï¼›è¯ä¸å¤šä½†è®¤çœŸå¬ï¼Œç»†èŠ‚é‡Œæœ‰æ¸©åº¦
- é¡¾ç›¼ï¼ˆ40ï¼‰ï¼šæ¡Œæ¸¸ç¤¾é™„è¿‘å¸¸èƒ½é‡åˆ°ä»–ï¼›ä¼šæ¥æ¢—ä¹Ÿä¼šæ”¶ä½ï¼Œè®©äººä¸å°´å°¬
- å¤æ˜Ÿæ™šï¼ˆ38ï¼‰ï¼šæ“åœºä¸ç½‘çƒç¤¾ä¹‹é—´çš„èº«å½±ï¼›è‡ªå¾‹é‡Œæœ‰æ¸©æŸ”ï¼Œå¾ˆä¼šç…§é¡¾äºº

> å¤‡æ³¨ï¼šæ‹›æ–°ä»…æ˜¯â€œå£³å­â€èƒŒæ™¯ï¼Œä¸ä¼šåå¤æ‰“æ–­è¯é¢˜ã€‚é™¤éç©å®¶ä¸»åŠ¨æåŠæˆ–è‡ªç„¶è¡”æ¥ï¼Œç³»ç»Ÿä¼šå…‹åˆ¶æŠŠè¯é¢˜æ‹‰å›â€œæ‹›æ–°/æŠ¥å/æµç¨‹â€ã€‚

---

## ğŸ—ï¸ æŠ€æœ¯æ ˆä¸ç»“æ„

- åç«¯ï¼šPython 3 + Flaskï¼ˆ`app.py` è·¯ç”±ï¼Œ`backend/` é¢†åŸŸä¸æœåŠ¡ï¼‰
- LLMï¼šDeepSeek Chat APIï¼ˆå¯æ›¿æ¢ï¼‰ï¼Œä»¥ system+user ç»„åˆå‘èµ·æ¨ç†
- Agentï¼š`BaseCharacter` é€šç”¨åŸºç±» + è§’è‰²ç±»ï¼ˆ`backend/domain/characters/`ï¼‰
- å­˜æ¡£ï¼š`GameStorage`ï¼ˆJSON åˆ° `saves/`ï¼‰
- å‰ç«¯ï¼šåŸç”Ÿ HTML/Bootstrap/jQueryï¼ˆä¼ªæ‰“å­—æœºã€è¿›åº¦æ¡åŠ¨ç”»ã€é€‰æ‹©å™¨ã€AJAXï¼‰
- ç«‹ç»˜ï¼š`frontend/static/images/*.png`

```
.
â”œâ”€â”€ web_start.py                 # ç»Ÿä¸€å…¥å£ï¼šåŠ è½½ .envã€æ£€æŸ¥ç›®å½•ã€å¯åŠ¨ Flask
â”œâ”€â”€ app.py                       # è·¯ç”±ï¼š/api/start_game /api/chat /api/save /api/load
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”œâ”€â”€ characters/          # BaseCharacter + å„è§’è‰²ç±»ï¼ˆSuTang / LinYuhan / LuoYimo / GuPan / XiaXingwanï¼‰
â”‚   â”‚   â””â”€â”€ game_core.py         # è§’è‰²å·¥å‚ä¸èŠå¤©/çŠ¶æ€åˆ†å‘
â”‚   â”œâ”€â”€ services/                # Service åŒ…è£…ï¼ˆgame_serviceï¼‰
â”‚   â”œâ”€â”€ game_storage.py          # JSON å­˜æ¡£
â”‚   â””â”€â”€ config.py                # PROMPTS_DIR ç­‰
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ templates/               # index.html / layout.html
â”‚   â””â”€â”€ static/
â”‚       â”œâ”€â”€ js/main.js           # UI äº¤äº’ä¸ AJAXã€é¢„è§ˆä¸å¤´åƒåˆ‡æ¢
â”‚       â””â”€â”€ css/style.css
â”œâ”€â”€ prompts/                     # å„è§’è‰² persona ä¸ analysis æ¨¡æ¿
â””â”€â”€ saves/                       # å­˜æ¡£è¾“å‡ºç›®å½•ï¼ˆsave_1.json ...ï¼‰
```

---

## ğŸ”§ å¿«é€Ÿå¼€å§‹ï¼ˆWindows/Powershellï¼‰

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿ï¼š

- å·²å®‰è£… Python 3.10+ï¼ˆå»ºè®® 3.12/3.13ï¼‰ã€‚æ£€æŸ¥ï¼š

```powershell
python --version; pip --version
# è‹¥æç¤ºæœªæ‰¾åˆ° pythonï¼Œå¯å°è¯•ï¼š
py --version; py -m pip --version
```

- ä½ æ­£åœ¨ Windows PowerShell ä¸­æ“ä½œï¼ˆä¸æ˜¯ CMDï¼‰ã€‚
- æœ¬é¡¹ç›®æ ¹ç›®å½•ä¸‹å°†åˆ›å»º `.venv/` è™šæ‹Ÿç¯å¢ƒï¼›æ— éœ€ä½¿ç”¨ä»“åº“é‡Œçš„ `web_venv/`ï¼ˆé‚£æ˜¯æœ¬åœ°ç¯å¢ƒï¼Œä¸å¯ç§»æ¤ï¼‰ã€‚

1) å…‹éš†ä¸è¿›å…¥ç›®å½•

```powershell
git clone https://github.com/ä½ çš„ç”¨æˆ·å/Lyuyuan_AI.git
cd Lyuyuan_AI
```

2) åˆ›å»ºä¸æ¿€æ´»ç¯å¢ƒ

```powershell
# ä»»æ„ä¸€ç§å¯ç”¨å‘½ä»¤åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv .venv  # æˆ–è€…
py -3.11 -m venv .venv

# æ¿€æ´»ï¼ˆPowerShellï¼‰
.\.venv\Scripts\Activate.ps1

# å¦‚é‡â€œè¿è¡Œè„šæœ¬è¢«ç¦ç”¨â€(Execution Policy) æŠ¥é”™ï¼Œå¯ä¸´æ—¶æ”¾å¼€æœ¬ä¼šè¯ï¼š
Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass
.\.venv\Scripts\Activate.ps1
```

3) å®‰è£…ä¾èµ–

```powershell
python -m pip install -U pip
pip install -r requirements.txt
```

4) é…ç½® LLM å¯†é’¥ï¼ˆä»¥Deepseek APIä¸ºä¾‹ï¼‰

- æ‰“å¼€Deepseekå®˜ç½‘ï¼Œè¿›å…¥å³ä¸Šè§’çš„ API å¼€æ”¾å¹³å°ï¼Œå……å€¼ï¼ˆå‡ å—é’±å°±å¤Ÿäº†å¯ä»¥ç”¨å¥½ä¹…å¥½ä¹…ï¼‰ååˆ›å»ºAPI Keyåå¤åˆ¶ã€‚

- æ–°å»º `.env`ï¼ˆæˆ–å¤åˆ¶ `.env.example`ï¼‰å¹¶å†™å…¥ï¼š
```
DEEPSEEK_API_KEY="sk-xxxxxxxxxxxxxxxx"
```
- æœªé…ç½®å¯†é’¥æ—¶ï¼ŒæœåŠ¡ä»å¯å¯åŠ¨ä»¥è°ƒè¯•å‰ç«¯ï¼›é¦–æ¬¡è°ƒç”¨èŠå¤©ä¼šå¤±è´¥ï¼ˆæ§åˆ¶å°æœ‰æç¤ºï¼‰ã€‚
  - `.env` æ–‡ä»¶æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼ˆä¸ `web_start.py` åŒçº§ï¼‰ã€‚

5) å¯åŠ¨æœåŠ¡

```powershell
python web_start.py
```

æç¤ºï¼š
- é¦–æ¬¡å¯åŠ¨å¯èƒ½å¼¹å‡º Windows é˜²ç«å¢™æç¤ºï¼Œé€‰æ‹©â€œå…è®¸è®¿é—®â€ã€‚
- ç»ˆæ­¢æœåŠ¡ï¼šåœ¨è¯¥ç»ˆç«¯æŒ‰ Ctrl+Cã€‚

æµè§ˆå™¨è®¿é—® http://127.0.0.1:5000ï¼Œé€‰æ‹©è§’è‰²åâ€œå¼€å§‹æ¸¸æˆâ€ã€‚

---

## âš¡ ä¸€è¡Œå¯åŠ¨ï¼ˆå¯é€‰ï¼šä½¿ç”¨ uvï¼‰

[uv](https://github.com/astral-sh/uv) æ˜¯ä¸€ä¸ªè¶…å¿«çš„ Python åŒ…ç®¡ç†ä¸æ‰§è¡Œå·¥å…·ï¼Œæ”¯æŒæŒ‰ `pyproject.toml` è‡ªåŠ¨è§£æä¾èµ–ã€‚å·²æä¾› `pyproject.toml`ï¼Œå¯æ— éœ€æ‰‹åŠ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼š

### å®‰è£… uv

Windows (PowerShell)ï¼š
```powershell
pip install uv  # æˆ–å‚è€ƒå®˜æ–¹å®‰è£…è„šæœ¬
```

macOS/Linuxï¼š
```bash
pip install uv  # æˆ–ä½¿ç”¨å®˜æ–¹å®‰è£…æ–¹å¼
```

### ç›´æ¥è¿è¡Œ

```bash
uv run web_start.py
```

ç¬¬ä¸€æ¬¡ä¼šè‡ªåŠ¨è§£æä¾èµ–å¹¶åˆ›å»ºéš”ç¦»ç¯å¢ƒï¼ˆç¼“å­˜å¤ç”¨ï¼‰ã€‚ä½ ä»å¯å¹¶è¡Œä¿ç•™ä¼ ç»Ÿ venv æ–¹å¼ï¼›äºŒè€…äº’ä¸å†²çªã€‚

> è‹¥éœ€è¦è¿›å…¥ä¸€ä¸ªäº¤äº’ shellï¼š`uv run python`ï¼›æˆ–å®‰è£…å¼€å‘å¯é€‰ä¾èµ–ï¼š`uv add <package>`ã€‚

---

## ğŸ”§ å¿«é€Ÿå¼€å§‹ï¼ˆmacOS / zsh æˆ– bashï¼‰

1) å…‹éš†ä¸è¿›å…¥ç›®å½•

```bash
git clone https://github.com/ä½ çš„ç”¨æˆ·å/Lyuyuan_AI.git
cd Lyuyuan_AI
```

2) åˆ›å»ºä¸æ¿€æ´»ç¯å¢ƒ

```bash
python3 -m venv .venv
source .venv/bin/activate
```

3) å®‰è£…ä¾èµ–

```bash
python3 -m pip install -U pip
pip3 install -r requirements.txt
```

4) é…ç½® LLM å¯†é’¥ï¼ˆä»¥Deepseek APIä¸ºä¾‹ï¼‰

- æ‰“å¼€Deepseekå®˜ç½‘ï¼Œè¿›å…¥å³ä¸Šè§’çš„ API å¼€æ”¾å¹³å°ï¼Œå……å€¼ï¼ˆå‡ å—é’±å°±å¤Ÿäº†å¯ä»¥ç”¨å¥½ä¹…å¥½ä¹…ï¼‰ååˆ›å»ºAPI Keyåå¤åˆ¶ã€‚

- æ–°å»º `.env`ï¼ˆæˆ–å¤åˆ¶ `.env.example`ï¼‰å¹¶å†™å…¥ï¼š
```
DEEPSEEK_API_KEY="sk-xxxxxxxxxxxxxxxx"
```
- æœªé…ç½®å¯†é’¥æ—¶ï¼ŒæœåŠ¡ä»å¯å¯åŠ¨ä»¥è°ƒè¯•å‰ç«¯ï¼›é¦–æ¬¡è°ƒç”¨èŠå¤©ä¼šå¤±è´¥ï¼ˆæ§åˆ¶å°æœ‰æç¤ºï¼‰ã€‚
  - `.env` æ–‡ä»¶æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼ˆä¸ `web_start.py` åŒçº§ï¼‰ã€‚

5) å¯åŠ¨æœåŠ¡

```bash
python3 web_start.py
```

åœ¨æµè§ˆå™¨è®¿é—® http://127.0.0.1:5000ã€‚åœæ­¢æœåŠ¡æŒ‰ Ctrl+Cã€‚

---

## â“å¸¸è§é—®é¢˜æ’æŸ¥ï¼ˆWindows/macOSï¼‰

- python/pip å‘½ä»¤æ‰¾ä¸åˆ°ï¼š
  - Windows ç”¨ `py` å’Œ `py -m pip`ï¼›macOS ç”¨ `python3` å’Œ `pip3`ã€‚
- æ¿€æ´»è™šæ‹Ÿç¯å¢ƒæ—¶æŠ¥â€œè¿è¡Œè„šæœ¬è¢«ç¦ç”¨â€ï¼š
  - PowerShell æ‰§è¡Œï¼š`Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass` åå†æ¿€æ´»ã€‚
- å¯åŠ¨åç«‹åˆ»é€€å‡ºï¼ˆExit Code: 1ï¼‰æˆ–æŠ¥æ¨¡å—ç¼ºå¤±ï¼ˆå¦‚ Flaskï¼‰ï¼š
  - ç¡®è®¤å·²æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼Œå¹¶é‡æ–°æ‰§è¡Œ `pip install -r requirements.txt`ã€‚
- 5000 ç«¯å£è¢«å ç”¨ï¼š
  - å…³é—­å ç”¨è¯¥ç«¯å£çš„ç¨‹åºï¼Œæˆ–æš‚æ—¶æ”¹ç«¯å£ï¼ˆç¼–è¾‘ `web_start.py`/`app.py` ä¸­çš„ `port=5000` ä¸ºå…¶ä»–æœªå ç”¨ç«¯å£ï¼‰ã€‚
- æœªé…ç½® DEEPSEEK_API_KEYï¼š
  - å‰ç«¯å¯æ­£å¸¸æ‰“å¼€å’Œæ“ä½œï¼Œé¦–æ¬¡èŠå¤©è¯·æ±‚ä¼šå¤±è´¥ï¼›é…ç½® `.env` åé‡å¯æœåŠ¡å³å¯ã€‚

---

## ğŸ”Œ API æ¦‚è§ˆ

- POST `/api/start_game`
  - è¯·æ±‚ï¼š`{ "role": "su_tang" | "lin_yuhan" | "luo_yimo" | "gu_pan" | "xia_xingwan" }`
  - å“åº”ï¼š`{ intro_text, game_state, history, character_key, character_name }`
  - è¯´æ˜ï¼š`history` ä»…è¿”å› user/assistantï¼ˆè¿‡æ»¤ systemï¼‰ï¼›ç”¨äºå‰ç«¯é‡å»ºå¯è§èŠå¤©ã€‚

- POST `/api/chat`
  - è¯·æ±‚ï¼š`{ "message": "..." }`
  - å“åº”ï¼š`{ response, game_state, character_key, character_name }`
  - è¯´æ˜ï¼šåç«¯ä¼šè°ƒç”¨ LLM äº§å‡º `<analysis>` JSON ä¸ `<response>`ï¼Œå¹¶æ®æ­¤æ›´æ–°å¥½æ„Ÿ/æ— èŠ/å…³ç³»ç­‰çŠ¶æ€ã€‚

- POST `/api/save`
  - è¯·æ±‚ï¼š`{ "slot": 1, "label"?: "å¯é€‰åç§°" }`
  - å“åº”ï¼š`{ success: true|false }`

- POST `/api/load`
  - è¯·æ±‚ï¼š`{ "slot": 1 }`
  - å“åº”ï¼š`{ success, game_state, history, character_key, character_name }`
  - è¯´æ˜ï¼šè‹¥å­˜æ¡£å« `meta.role`ï¼Œä¼šè‡ªåŠ¨åˆ‡åˆ°å¯¹åº”è§’è‰²å†åŠ è½½ã€‚

- GET `/api/saves`
  - å“åº”ï¼š`{ saves: [...] }`ï¼ˆåŒ…å« `slot`ã€`meta`ã€`mtime` ç­‰ï¼Œä¾¿äºåœ¨å‰ç«¯åˆ—è¡¨å±•ç¤ºï¼‰

---

### æœ€æ–°ç‰ˆæœ¬ï¼šv1.0.1 ï¼ˆ2025.10.15ï¼‰